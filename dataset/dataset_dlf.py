# -*- coding: utf-8 -*-
"""dataset_DLF.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1k8_rEPFy4l1IZG48xF9d0TQcXM3BVCUQ
"""

!pip install datasets

import torch
from torch.utils.data import DataLoader
import torchvision.transforms as transforms
from datasets import load_dataset

dataset = load_dataset("theneuralmaze/celebrity_faces").with_format('torch')['train']
print(dataset)

transformer = transforms.Compose([
    transforms.ConvertImageDtype(torch.float32),
])

def transform(example):
    example['image'] = transformer(example['image'])
    return example

test_transformer = transforms.Compose([
    transforms.ConvertImageDtype(torch.float32),
    transforms.ColorJitter(brightness=0.2, contrast=0.3, saturation=0.2, hue=0.1) ])

def test_transform(example):
    example['image'] = test_transformer(example['image'])
    return example

unique_labels = set(dataset['label'])
num_unique_labels = len(unique_labels)
print(f"Number of calebrities: {num_unique_labels}")

from collections import Counter

label_counts = Counter(dataset['label'])
print(f"Number of photos of a given celebrity:")
label_counts

def filter_labels(example):
  return label_counts[example['label']] >= 13

filtered_dataset = dataset.filter(filter_labels)

ds = filtered_dataset.map(transform, batched=False)

split = ds.train_test_split(test_size=0.2)
train_ds, test_ds = split['train'], split['test']

train_loader = DataLoader(train_ds, shuffle=True)
test_loader = DataLoader(test_ds, shuffle=False)

test_ds = test_ds.map(test_transform, batched=False)